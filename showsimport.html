<!doctype html>
<html ng-app="myapp">
  <body ng-app="import" ng-controller="Ctrl">
    https://<input ng-model="firebaseid">torid-fire-5021.firebaseio.com<br />
    <button ng-click="import()">Import Shows to {{'https://torid-fire-5021.firebaseio.com/shows'}}</button>
    <span ng-show="completed">Shows successfully imported!</span>
    <div ng-repeat="show in shows">{{ show }}</div>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.1.5/angular.min.js'></script>
    <script src='https://cdn.firebase.com/v0/firebase.js'></script>
    <script src='https://cdn.firebase.com/libs/angularfire/0.3.0/angularfire.min.js'></script>
    <script>
      var app = angular.module("myapp", ["firebase"]);
      function Ctrl($scope) {
        $scope.shows = [];
        $scope.firebaseid = "torid-fire-5021";
        $scope.import = function() {
          var showArr = [{"year":2010,"month":5,"day":16,"venue":"BIRDY'S","bands":[]},{"year":2010,"month":6,"day":3,"venue":"KITLEY HOUSE PARTY","bands":[]},{"year":2010,"month":7,"day":7,"venue":"THE EMERSON","bands":["BOTB"]},{"year":2010,"month":7,"day":20,"venue":"BIRDY'S","bands":["BOTB"]},{"year":2010,"month":8,"day":12,"venue":"THE GEAR","bands":["GAMBIT'S DECIPLES","NUCLEAR AFTERPARTY"]},{"year":2010,"month":8,"day":25,"venue":"HOUSE PARTY","bands":["BLACK-LIGHT PARTY"]},{"year":2010,"month":9,"day":9,"venue":"BIRDY'S","bands":[]},{"year":2011,"month":0,"day":1,"venue":"BIRDY'S","bands":["NUCLEAR AFTERPARTY","SUGAR MOON RABBIT"]},{"year":2011,"month":0,"day":16,"venue":"THE EMERSON","bands":["BOTB", "THE WORLD'S SLOWEST COMEBACK"]},{"year":2011,"month":2,"day":26,"venue":"ES JUNGLE","bands":["NUCLEAR AFTERPARTY","INDIAN CITY WEATHER","ACCORDIONS","DAVY LONG"]},{"year":2011,"month":3,"day":22,"venue":"VOLLRATH","bands":["BLACKTOP SIDEWAYS","NUCLEAR AFTERPARTY","LIZA DAY"]},{"year":2011,"month":4,"day":7,"venue":"MINI MARATHON","bands":[]},{"year":2011,"month":5,"day":11,"venue":"HOUSE PARTY","bands":["SCUMBELINA"]},{"year":2011,"month":5,"day":25,"venue":"BACK YARD SHOW","bands":[]},{"year":2011,"month":6,"day":8,"venue":"VOLLRATH","bands":["DEMAGGIO","APEX PREDATOR","THE HOLLAND ACCOUNT","SYN AESTESIA","SINNERFOLD"]},{"year":2011,"month":6,"day":17,"venue":"MELODY INN","bands":["NEW ADDICTION","THE WORLD'S SLOWEST COMEBACK"]},{"year":2011,"month":6,"day":21,"venue":"MARION COUNTY FAIR","bands":["SUGAR MOON RABBIT"]},{"year":2011,"month":6,"day":23,"venue":"THE EMERSON","bands":["CROSSTOWN COLLISION","TRACK NINE","EARTHBOUND","CHANDELIER BALLROOM"]},{"year":2011,"month":6,"day":24,"venue":"CASTLETON GRILL","bands":[]},{"year":2011,"month":7,"day":11,"venue":"BIRDY'S","bands":["I BELIEVE IN HOT PANTS","MODERN MOTION"]},{"year":2011,"month":7,"day":17,"venue":"MELODY INN","bands":["SUGAR MOON RABBIT","ALL AT ONCE"]},{"year":2011,"month":8,"day":2,"venue":"VOLLRATH","bands":["THESE CITYLIMITS","PHOENIX ON THE FAULT LINE","MODERN MOTION"]},{"year":2011,"month":8,"day":10,"venue":"HARD ROCK CAFE","bands":["CHUCK D","MIDWEST STATE OF MIND"]},{"year":2011,"month":8,"day":17,"venue":"ROCK HOUSE","bands":[]},{"year":2011,"month":8,"day":21,"venue":"VISIONS","bands":["CORDOR BENEFIT"]},{"year":2011,"month":9,"day":15,"venue":"MONKEY'S TALE","bands":["TOY DRIVE"]},{"year":2011,"month":9,"day":22,"venue":"LOCALS ONLY","bands":["HOMELESS BENEFIT"]},{"year":2011,"month":9,"day":30,"venue":"RIVIERA CLUB","bands":["MONSTER BASH!"]},{"year":2011,"month":10,"day":2,"venue":"THE MELODY INN","bands":["SUGAR MOON RABBIT","HANDDOG HEARTS"]},{"year":2011,"month":10,"day":11,"venue":"INDY'S JUKE BOX","bands":["CHEMICAL ENVY","MODEL STRANGER","MIDNIGHT GHOST TRAIN","SYN AESTESIA"]},{"year":2011,"month":10,"day":18,"venue":"VISIONS","bands":["CADEN'S CRY","CHEMICAL X","LUMINOTH"]},{"year":2011,"month":10,"day":19,"venue":"ROCK HOUSE","bands":["THESE CITY LIMITS","THE HOLLAD ACCOUNT","CHEMICAL ENVY","KNOLLWOOD BOYS"]},{"year":2011,"month":11,"day":2,"venue":"SHOW ME'S","bands":["THE WORLD'S SLOWEST COMEBACK","DALAID"]},{"year":2011,"month":11,"day":9,"venue":"JUKE BOX - FRANKLIN","bands":["MR. CLIT & THE PINK CIGARETTES"]},{"year":2011,"month":11,"day":16,"venue":"ROCK HOUSE","bands":["ACCEPT REGRET","KID COMET","NOYOKOS"]},{"year":2011,"month":11,"day":31,"venue":"INDY'S JUKE BOX","bands":["CHEMICAL ENVY","THESE CITY LIMITS","SUN AESTESIA","APEX PREDATOR","MR. CLIT & THE PINK CIGARETTES"]},{"year":2012,"month":0,"day":14,"venue":"MELODY INN","bands":["UPSHOT"]},{"year":2012,"month":0,"day":20,"venue":"BIRDY'S","bands":["MIDWEST STATE OF MIND","LULWAER","5 DAY TRIP","PRAGMATIC"]},{"year":2012,"month":0,"day":21,"venue":"ROCK HOUSE","bands":["CHEMICAL ENVY","SUGAR MOON RABBIT","RADIO FX"]},{"year":2012,"month":0,"day":27,"venue":"SUPER BOWL SHOW","bands":["COY-KOI","D-RAILED"]},{"year":2012,"month":0,"day":29,"venue":"VISIONS","bands":["NERVOUS HERMUS","MR. CLIT & THE PINK CIGARETTES","APEX PREDATOR"]},{"year":2012,"month":1,"day":10,"venue":"LIZARDS","bands":["KALO","UPSHOT"]},{"year":2012,"month":2,"day":9,"venue":"INDY'S JUKE BOX","bands":["NO PIT CHERRIES","COY-KOI","MISUNDERSTOOD"]},{"year":2012,"month":2,"day":23,"venue":"ROCK HOUSE","bands":["HANGER HEAD","MODEL STRANGER","NEW FINLAND RADICALS"]},{"year":2012,"month":3,"day":20,"venue":"COME TOGETHER","bands":["THE WORLD'S SLOWEST COMEBACK","COY-KOI","CHANDELIER BALLROOM"]},{"year":2012,"month":4,"day":4,"venue":"ROCK HOUSE","bands":["LIVID","THE NEW GUILT"]},{"year":2012,"month":4,"day":5,"venue":"OCCUSTOCK","bands":[]},{"year":2012,"month":4,"day":19,"venue":"THE DELUXE","bands":[]},{"year":2012,"month":4,"day":28,"venue":"MELODY INN","bands":["KO","THE BLACK BOX REVELATION"]},{"year":2012,"month":5,"day":2,"venue":"SAM ASH","bands":[]},{"year":2012,"month":5,"day":15,"venue":"ROCK HOUSE","bands":["CHEMICAL ENVY","THEY'VE SHOT FLANIGAN","SUGAR MOON RABBIT","UP 4 DAZE"]},{"year":2012,"month":5,"day":30,"venue":"LOCALS ONLY","bands":["CHEMICAL ENVY","DEAD MANS SWITCH","NERVOUS HERMUS","BREAKDOWN KINGS"]},{"year":2012,"month":6,"day":14,"venue":"ROCK HOUSE","bands":["BOTB 1 - MINUTE DETAILS"]},{"year":2012,"month":6,"day":20,"venue":"RHINOS","bands":["WASHINGTON AND OUT","DEEZEN"]},{"year":2012,"month":6,"day":21,"venue":"BIRDY'S","bands":["ATTAKULLA"]},{"year":2012,"month":6,"day":22,"venue":"KIDDIE PUNK SHOW","bands":[]},{"year":2012,"month":6,"day":24,"venue":"CASTLETON GRILL","bands":[],"notes":"AHNAH'S PARTY"},{"year":2012,"month":7,"day":3,"venue":"ART BANK - MASS AVE","bands":[]},{"year":2012,"month":7,"day":9,"venue":"PEPPERS","bands":["NO PIT CHERRIES","COY-KOI"]},{"year":2012,"month":7,"day":10,"venue":"PEPPERS","bands":["MINUTE DETAILS","CABIN PRESSURE"]},{"year":2012,"month":7,"day":11,"venue":"BEALE STREET","bands":["THESE CITY LIMITS","PARTY LINES","YEARS"]},{"year":2012,"month":7,"day":18,"venue":"SAUSAGE FEST","bands":[]},{"year":2012,"month":7,"day":25,"venue":"ROCK HOUSE","bands":["BOTB 2"]},{"year":2012,"month":7,"day":30,"venue":"PEPPERS","bands":["AUDIODACITY","MIDWEST STATE OF MIND"]},{"year":2012,"month":8,"day":21,"venue":"PEPPERS","bands":["NO PIT CHERRIES","COY-KOI"]},{"year":2012,"month":8,"day":29,"venue":"ROCKHOUSE","bands":["BOTB 3 - HALIBRID","CHAINED FATE","THORN 4 MEMORY","BIONIC MONKS"]},{"year":2012,"month":9,"day":6,"venue":"VISIONS","bands":["LOSING SEPTEMBER","A FALL TO BREAK","PRAGMATIC"]},{"year":2012,"month":9,"day":12,"venue":"ROCK HOUSE","bands":["NO PIT CHERRIES","POLARIZER","MONTEZUMA FIRE MACHINE"]},{"year":2012,"month":9,"day":27,"venue":"NICKEL PLATE FEST","bands":[]},{"year":2012,"month":9,"day":28,"venue":"ROCK HOUSE","bands":["AUDIODACITY","MINUTE DETAILS","NO PIT CHERRIES","THESE CITY LIMITS","VERDANT VERA","MR. CLIT & THE PINK CIGARETTES","MIDWEST STATE OF MIND"]},{"year":2012,"month":10,"day":24,"venue":"BIRDY'S","bands":["NO PIT CHERRIES","MINUTE DETAILS","SWIG"]},{"year":2012,"month":11,"day":8,"venue":"KATMANDU","bands":["SUGAR MOON RABBIT"]},{"year":2012,"month":11,"day":29,"venue":"SKY BAR","bands":["AUDIODACITY","MIDWEST HYPE"]},{"year":2013,"month":0,"day":5,"venue":"BIRDY'S","bands":["NO PIT CHERRIES","MINUTE DETAILS","CHAKRAS"]},{"year":2013,"month":0,"day":25,"venue":"HOOSIER DOME","bands":["CHEMICAL ENVY","VESERIA","THEY'VE SHOT FLANIGAN"]},{"year":2013,"month":1,"day":20,"venue":"MELODY INN","bands":["NO PIT CHERRIES","THE KICKAWAYS","SWIG"]},{"year":2013,"month":2,"day":18,"venue":"RAW","bands":["COUP D'ETAT","MIDWEST STATE OF MIND"]},{"year":2013,"month":2,"day":22,"venue":"BIRDY'S","bands":["NO PIT CHERRIES","CHEMICAL ENVY","CHAKRAS"]},{"year":2013,"month":3,"day":19,"venue":"BEALE STREET","bands":["KNOLLWOOD BOYS","THE MUNDIES","SWIG"]},{"year":2013,"month":3,"day":28,"venue":"BEALE STREET","bands":["MINUTE DETAILS","SQUARE SOCIAL CIRCLE"]},{"year":2013,"month":4,"day":3,"venue":"ROCK HOUSE","bands":["COUP D'ETAT","DEAD BIRDS ADORE US","CHICAGO TYPEWRITERS"]},{"year":2013,"month":4,"day":25,"venue":"ROCK HOUSE","bands":["VESERIA","VERDANT VERA","MODEL STRANGER","MR. CLIT & THE PINK CIGARETTES"]},{"year":2013,"month":5,"day":22,"venue":"BIRDY'S","bands":["COUP D'ETAT","GOLIATHON"]},{"year":2013,"month":6,"day":19,"venue":"ROCK HOUSE","bands":["LITTLE YELLOW DIFFERENT","BIZARRE NOIR","PHOENIX ON THE FALT LINE","DEVIL TO PAY"]},{"year":2013,"month":6,"day":21,"venue":"BEALE STREET","bands":["NICK WINN BENEFIT"]},{"year":2013,"month":6,"day":23,"venue":"CASTLETON GRILL","bands":[],"notes":"AHNAH'S PARTY"},{"year":2013,"month":7,"day":6,"venue":"HOOSIER DOME","bands":["THE RED STREAK","O'BROTHER"]},{"year":2013,"month":7,"day":12,"venue":"CLAUDE & ANNIE'S","bands":["MINUTE DETAILS"]},{"year":2013,"month":7,"day":17,"venue":"CHARLIEPALOOZA","bands":["PABLO'S KILLERS","NO NAME BAND"]},{"year":2013,"month":7,"day":24,"venue":"KAMMY'S KAUSE","bands":["AUDIODACITY","BLEEDING KEYS","TWIN CATS"]},{"year":2013,"month":7,"day":30,"venue":"ROCK HOUSE","bands":["COUP D'ETAT","BLUE EYED JESUS","TESLA ARMADA","APEX PREDATOR"]},{"year":2013,"month":8,"day":13,"venue":"BACKYARD PARTY","bands":[]},{"year":2013,"month":8,"day":18,"venue":"SABBATICAL","bands":["FINER","JET W. LEE"]},{"year":2013,"month":8,"day":28,"venue":"BIRDY'S","bands":["SQUARE SOCIAL CIRCLE","K-FLAT","THE GRINNING MAN"]},{"year":2013,"month":9,"day":12,"venue":"BEALE STREET","bands":["FLESHSUIT","THESE CITY LIMITS","DAVE DEMAGGIO","I EXIST"]},{"year":2013,"month":9,"day":19,"venue":"BIRDY'S","bands":["SCUMBELINA","MINUTE DETAILS","BLEEDING KEYS","MONTEZUMA FIRE MACHINE"]},{"year":2013,"month":9,"day":31,"venue":"86TH STREET PUB","bands":["SHINE HALLOWEEN BASH"]},{"year":2013,"month":10,"day":2,"venue":"ROCK HOUSE","bands":["AUDIODACITY","SHADELAND","PARTY LINES"]},{"year":2013,"month":11,"day":14,"venue":"KATMANDU","bands":["COUP D'ETAT","MIDWEST STATE OF MIND"]},{"year":2014,"month":0,"day":24,"venue":"BIRDY'S","bands":["AUDIODACITY","BREAKDOWN KINGS"]},{"year":2014,"month":1,"day":28,"venue":"BIRDY'S","bands":["SQUARE SOCIAL CIRCLE","BLACK LIONS"]},{"year":2014,"month":3,"day":11,"venue":"MOUSE TRAP","bands":["AUDIODACITY","NO PIT CHERRIES","SUGAR MOON"]},{"year":2014,"month":3,"day":27,"venue":"CINCINNATI","bands":["CHICKEN BONE"]},{"year":2014,"month":4,"day":10,"venue":"HOUSE PARTY","bands":[]},{"year":2014,"month":4,"day":31,"venue":"BIRDY'S","bands":[]},{"year":2014,"month":5,"day":6,"venue":"TIM'S B-DAY","bands":[]},{"year":2014,"month":6,"day":24,"venue":"CASTLETON GRILL","bands":[]},{"year":2014,"month":7,"day":1,"venue":"DDDs","bands":[]}];
          var ref = new Firebase('https://'+$scope.firebaseid+'.firebaseio.com/shows');
          var bandRef = new Firebase('https://'+$scope.firebaseid+'.firebaseio.com/bands');
          var bandPriority; 

          var testPriority = function (band) {
            var displayName = band;
            band = band.toLowerCase();
            band = encodeURIComponent(band).replace(/\./g, '%2E');
            var start = band;


            var pad = "AAAAAAAAAA";
            start += pad.substring(0, pad.length - start.length);

            var blob = new Blob([start]);

            var reader = new FileReader();
            reader.onload = function(e) {
                var typedArray = new Uint8Array(e.target.result);
                var array = Array.prototype.slice.call(typedArray);
                var id;
                bandPriority = parseInt(array.join(""));
                console.log("Priority of", start, "is:", bandPriority);
                // child = bandRef.push({ name: displayName });
                // child.setPriority(bandPriority);
                bandRef.child(band).setWithPriority({ name: displayName }, band);
            }
            reader.readAsArrayBuffer(blob);
          };

          showArr.forEach(function(show, idx){
            var newShow = {};
            var date = new Date(show.year, show.month, show.day);
            newShow.date = (date.valueOf() / 1000).toString(); // Javascript works in miliseconds, so convert to seconds
            newShow.venue = show.venue;
            newShow.number = ++idx;
            if (show.notes) {
              newShow.notes = show.notes;
            } else {
              newShow.notes = '';
            }
            ref.child(newShow.date).setWithPriority(newShow, -newShow.date);
            show.bands.forEach(function(band){
              var test = ref.child(newShow.date).child("bands").push({"name": band});
              testPriority(band);
            });
            $scope.shows.push(newShow);
          });
          $scope.completed = true;
        }
      }
    </script>
  </body>
</function>
